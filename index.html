<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Doncaster Coffee Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    .mapboxgl-popup-content {
      background-color: rgba(255, 255, 255, 0.85) !important;
      border-radius: 6px;
      padding: 8px 12px;
      font-family: sans-serif;
      max-width: 220px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.2);
    }
    .custom-popup strong {
      font-weight: bold;
      display: block;
      margin-bottom: 4px;
    }
    .custom-popup p {
      font-size: 0.85em;
      font-style: italic;
      margin: 0 0 6px;
    }
    .custom-popup a.directions-btn {
      display: inline-flex;
      align-items: center;
      background-color: #EA736B;
      color: white;
      padding: 6px 10px;
      border-radius: 16px;
      font-size: 0.9em;
      text-decoration: none;
      transition: background-color 0.2s;
    }
    .custom-popup a.directions-btn:hover {
      background-color: #d45f57;
    }
    .custom-popup a.directions-btn svg {
      margin-right: 4px;
    }
    .search-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
      background: white;
      border-radius: 6px;
      padding: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    #search-input {
      padding: 6px;
      width: 240px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #search-suggestions {
      background: white;
      border: 1px solid #ccc;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 4px;
      border-radius: 4px;
    }
    .suggestion-item {
      padding: 6px;
      cursor: pointer;
    }
    .suggestion-item:hover {
      background-color: #f0f0f0;
    }
    .no-result {
      padding: 6px;
      color: gray;
    }
  </style>
</head>
<body>
<div class="search-container">
  <input type="text" id="search-input" placeholder="Search coffee places..." />
  <div id="search-suggestions"></div>
</div>
<div id="map"></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoic2lnaHRzZWVrciIsImEiOiJjbWJheDU5dWwwbjZqMmxzYjRqaW0wZ2FoIn0.XjR_Z_6vL3dcXrVECelgiA';

const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/sightseekr/cmdlr4rap009h01r23f5z6h7i',
  center: [-1.133, 53.522],
  zoom: 11.3
});

map.addControl(new mapboxgl.NavigationControl());
map.addControl(new mapboxgl.GeolocateControl({
  positionOptions: { enableHighAccuracy: true },
  trackUserLocation: true,
  showUserHeading: true
}));

let hoveredPopup = null;
let popupEl = null;
let overPopup = false;
let activePopup = null;

const layers = ['city-centre-new', 'across-doncaster'];

map.on('load', () => {
  layers.forEach(layer => {
    map.on('mouseenter', layer, (e) => {
      map.getCanvas().style.cursor = 'pointer';

      if (hoveredPopup) hoveredPopup.remove();
      if (activePopup) activePopup.remove();

      const feature = e.features[0];
      const name = feature.properties.name || "No title";
      const description = feature.properties.description || "No description";
      const directionsURL = directionsURLs[name] || `https://www.google.com/maps/dir/?api=1&destination=${e.lngLat.lat},${e.lngLat.lng}`;

      hoveredPopup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false })
        .setLngLat(e.lngLat)
        .setHTML(`<div class="custom-popup" id="popup-content">
          <strong>${name}</strong>
          <p>${description}</p>
          <a class="directions-btn" href="${directionsURL}" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 24 24"><path d="M12 2C8.13401 2 5 5.13401 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13401 15.866 2 12 2ZM12 11.5C10.6193 11.5 9.5 10.3807 9.5 9C9.5 7.61929 10.6193 6.5 12 6.5C13.3807 6.5 14.5 7.61929 14.5 9C14.5 10.3807 13.3807 11.5 12 11.5Z"/></svg>
            Directions
          </a>
        </div>`) 
        .addTo(map);

      setTimeout(() => {
        popupEl = document.getElementById('popup-content');
        if (popupEl) {
          popupEl.addEventListener('mouseenter', () => overPopup = true);
          popupEl.addEventListener('mouseleave', () => {
            overPopup = false;
            setTimeout(() => {
              if (!overPopup && hoveredPopup) {
                hoveredPopup.remove();
                hoveredPopup = null;
              }
            }, 150);
          });
        }
      }, 0);
    });

    map.on('mouseleave', layer, () => {
      map.getCanvas().style.cursor = '';
      setTimeout(() => {
        if (!overPopup && hoveredPopup) {
          hoveredPopup.remove();
          hoveredPopup = null;
        }
      }, 150);
    });
  });

  map.on('click', (e) => {
    const features = map.queryRenderedFeatures(e.point, { layers });
    if (!features.length) return;
    if (activePopup) activePopup.remove();

    const feature = features[0];
    const name = feature.properties.name;
    const description = feature.properties.description;
    const coordinates = feature.geometry.coordinates;
    const directionsURL = directionsURLs[name] || `https://www.google.com/maps/dir/?api=1&destination=${coordinates[1]},${coordinates[0]}`;

    activePopup = new mapboxgl.Popup()
      .setLngLat(coordinates)
      .setHTML(`<div class="custom-popup">
        <strong>${name}</strong>
        <p>${description}</p>
        <a class="directions-btn" href="${directionsURL}" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 24 24"><path d="M12 2C8.13401 2 5 5.13401 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13401 15.866 2 12 2ZM12 11.5C10.6193 11.5 9.5 10.3807 9.5 9C9.5 7.61929 10.6193 6.5 12 6.5C13.3807 6.5 14.5 7.61929 14.5 9C14.5 10.3807 13.3807 11.5 12 11.5Z"/></svg>
          Directions
        </a>
      </div>`) 
      .addTo(map);
  });
});

const directionsURLs = {
  "Cornerstone Coffee": "https://www.google.com/maps?cid=272364922763009188",
  "TWEED at Wadworth": "https://www.google.com/maps?cid=9866149075741907923",
  "Feast Bawtry": "https://www.google.com/maps?cid=14094552448568676862",
  "Jimmy Piggs Coffee House": "https://www.google.com/maps?cid=9568668619399891490",
  "Highfield Coffee Social": "https://www.google.com/maps?cid=14653791595216298550",
  "Boston & Co Bentley Pavilion": "https://www.google.com/maps?cid=9765442256895214233",
  "West Street Coffee": "https://www.google.com/maps?cid=7732098197170659430",
  "The Little Goat Coffee Company": "https://www.google.com/maps?cid=8637990092590627598",
  "The Glass Strawberry": "https://www.google.com/maps?cid=17678315068369981247",
  "Cafe 1910 (In Danum Library, Gallery and Museum)": "https://www.google.com/maps?cid=1008549081973229459",
  "Old man Staveley's coffee co": "https://www.google.com/maps?cid=11699623048919577819",
  "Bone Idle Lounge": "https://google.com/maps?cid=11035181184400722709",
  "Jazz Cafe": "https://www.google.com/maps?cid=14635295943506975263",
  "Banco Coffee Co": "https://www.google.com/maps?cid=1769371057472287012",
  "Back in time cafe": "http://google.com/maps?cid=10559689921745810730",
  "Da Leo Restaurant": "https://www.google.com/maps?cid=6913375424484086838",
  "Doncaster Tourist Information Centre": "https://www.google.com/maps?cid=674239188930906122"
};

const allPlaceNames = Object.keys(directionsURLs);

const input = document.getElementById('search-input');
const suggestions = document.getElementById('search-suggestions');

function updateSuggestions(value) {
  const filtered = allPlaceNames.filter(name =>
    name.toLowerCase().includes(value.toLowerCase())
  );
  suggestions.innerHTML = '';

  if (filtered.length === 0) {
    suggestions.innerHTML = `<div class="no-result">Can't find what you're looking for here? Try <a href="https://www.google.com/maps" target="_blank">Google Maps</a> or browse the <a href="https://www.visitdoncaster.com" target="_blank">Visit Doncaster</a> site.</div>`;
    return;
  }

  filtered.forEach(name => {
    const item = document.createElement('div');
    item.className = 'suggestion-item';
    item.textContent = name;
    item.onclick = () => handleSearchSelection(name);
    suggestions.appendChild(item);
  });
}

function handleSearchSelection(name) {
  suggestions.innerHTML = '';
  input.value = name;

  layers.forEach(layer => {
    const features = map.querySourceFeatures(layer, {});
    features.forEach(feature => {
      if (feature.properties.name === name) {
        const coords = feature.geometry.coordinates;
        const description = feature.properties.description;
        const directionsURL = directionsURLs[name] || `https://www.google.com/maps/dir/?api=1&destination=${coords[1]},${coords[0]}`;

        if (activePopup) activePopup.remove();
        map.flyTo({ center: coords, zoom: 14 });

        activePopup = new mapboxgl.Popup()
          .setLngLat(coords)
          .setHTML(`<div class="custom-popup">
            <strong>${name}</strong>
            <p>${description}</p>
            <a class="directions-btn" href="${directionsURL}" target="_blank">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 24 24"><path d="M12 2C8.13401 2 5 5.13401 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13401 15.866 2 12 2ZM12 11.5C10.6193 11.5 9.5 10.3807 9.5 9C9.5 7.61929 10.6193 6.5 12 6.5C13.3807 6.5 14.5 7.61929 14.5 9C14.5 10.3807 13.3807 11.5 12 11.5Z"/></svg>
              Directions
            </a>
          </div>`) 
          .addTo(map);
      }
    });
  });
}

input.addEventListener('input', () => {
  updateSuggestions(input.value);
});

// Hide suggestions when clicking off
window.addEventListener('click', (e) => {
  if (!document.querySelector('.search-container').contains(e.target)) {
    suggestions.innerHTML = '';
  }
});
</script>
</body>
</html>




